% function run_experiments()

setup;

%{
% modelnet experiments
get_imdb('modelnet40v1', ...
  'func', @(s) setup_imdb_modelnet(s,'useUprightAssumption',true), ...
  'rebuild', true);
% phase 1 -- regular cnn
cnn_shape('modelnet40v1', ...
  'numFetchThreads', 12, ...
  'pad', 32, ...
  'border', 32, ...
  'multiview', false, ...
  'batchSize', 60, ...
  'gpus', [1], ...
  'maxIterPerEpoch', Inf, ...
  'numEpochs', [15 10 15], ...
  'learningRate', [0.05*ones(1,10) 0.01*ones(1,20) 0.001*ones(1,5) 0.0001*ones(1,5)] ...
);  
% phase 2 -- mvcnn
cnn_shape('modelnet40v1', ...
  'numFetchThreads', 12, ...
  'pad', 32, ...
  'border', 32, ...
  'baseModel', fullfile('data','imagenet-matconvnet-vgg-m-ft-modelnet40v1-simplenn','net-deployed.mat'), ...
  'multiview', true, ...
  'viewpoolPos', 'relu6', ...
  'batchSize', 5, ...
  'gpus', [1], ...
  'maxIterPerEpoch', Inf, ...
  'numEpochs', [0 15 15], ...
  'learningRate', [0.005*ones(1,5) 0.001*ones(1,5) 0.0001*ones(1,10) 0.00001*ones(1,10)] ...
);  
%}

% shapenet experiments
get_imdb('shapenet55v2', ...
  'func', @(s) setup_imdb_shapenet(s,'nViews',80,'useSubclass',true), ...
  'rebuild', true);
% phase 1 -- regular cnn
cnn_shape('shapenet55v2', ...
  'numFetchThreads', 12, ...
  'multiview', false, ...
  'batchSize', 80, ...
  'gpus', [1], ...
  'maxIterPerEpoch', 1000, ...
  'numEpochs', [4 2 4], ...
  'learningRate', [0.05*ones(1,2) 0.01*ones(1,6) 0.001*ones(1,2)] ...
);  
% phase 2 -- mvcnn
cnn_shape('shapenet55v2', ...
  'numFetchThreads', 12, ...
  'baseModel', fullfile('data','imagenet-matconvnet-vgg-m-ft-shapenet55v2-simplenn','net-deployed.mat'), ...
  'multiview', true, ...
  'viewpoolPos', 'relu7', ...
  'batchSize', 1, ...
  'gpus', [1], ...
  'maxIterPerEpoch', 1000, ...
  'numEpochs', [0 6 4], ...
  'learningRate', [0.005*ones(1,2) 0.001*ones(1,2) 0.0001*ones(1,4) 0.00001*ones(1,2)] ...
);  

